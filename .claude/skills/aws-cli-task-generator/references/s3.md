# S3 Command Patterns

## Create Bucket

```bash
# US-East-1 (default region)
aws s3api create-bucket \
  --bucket <bucket-name> \
  --region us-east-1

# Other regions (requires location constraint)
aws s3api create-bucket \
  --bucket <bucket-name> \
  --region us-west-2 \
  --create-bucket-configuration LocationConstraint=us-west-2
```

## Block Public Access (Recommended Default)

```bash
aws s3api put-public-access-block \
  --bucket <bucket-name> \
  --public-access-block-configuration \
    "BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true"
```

## Enable Versioning

```bash
aws s3api put-bucket-versioning \
  --bucket <bucket-name> \
  --versioning-configuration Status=Enabled
```

## Enable Encryption (Server-Side)

```bash
aws s3api put-bucket-encryption \
  --bucket <bucket-name> \
  --server-side-encryption-configuration '{
    "Rules": [{
      "ApplyServerSideEncryptionByDefault": {
        "SSEAlgorithm": "AES256"
      },
      "BucketKeyEnabled": true
    }]
  }'
```

## Lifecycle Policy (Auto-Delete Old Objects)

```bash
aws s3api put-bucket-lifecycle-configuration \
  --bucket <bucket-name> \
  --lifecycle-configuration '{
    "Rules": [{
      "Id": "DeleteOldObjects",
      "Status": "Enabled",
      "Expiration": {"Days": 90},
      "Filter": {}
    }]
  }'
```

## Tagging

```bash
aws s3api put-bucket-tagging \
  --bucket <bucket-name> \
  --tagging 'TagSet=[
    {Key=Environment,Value=prod},
    {Key=Owner,Value=devops}
  ]'
```

## Cleanup Commands

```bash
# Delete all objects (required before bucket deletion)
aws s3 rm s3://<bucket-name> --recursive

# Delete bucket
aws s3api delete-bucket --bucket <bucket-name>
```

## IAM Permissions

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:CreateBucket",
        "s3:DeleteBucket",
        "s3:PutBucketVersioning",
        "s3:PutBucketEncryption",
        "s3:PutBucketPublicAccessBlock",
        "s3:PutBucketTagging",
        "s3:PutLifecycleConfiguration",
        "s3:GetBucketLocation"
      ],
      "Resource": "arn:aws:s3:::*"
    },
    {
      "Effect": "Allow",
      "Action": [
        "s3:PutObject",
        "s3:GetObject",
        "s3:DeleteObject"
      ],
      "Resource": "arn:aws:s3:::*/*"
    }
  ]
}
```
